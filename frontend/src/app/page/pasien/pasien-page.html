<div class="container">
  <div class="row">
    <h1>Manajemen Pasien</h1>
  </div>
  <div class="row">
    <p>Kelola data identitas pasien</p>
  </div>
  <div class="container">
    <div class="row mb-3 mt-3">
      <button class="btn btn-primary lg:col-2 col-5 me-auto" (click)="openAddPasienDialog()">
        Tambah Pasien
      </button>
    </div>

    <div class="row mb-4 p-3 border rounded bg-light">
      <h5>Filter & Cari Data</h5>

      <div class="col-12 col-md-6 mb-3">
        <label class="form-label">Cari Nama Pasien</label>
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            placeholder="Ketik nama pasien..."
            [(ngModel)]="searchQuery"
            (keyup.enter)="onSearch()"
          />
          <button class="btn btn-outline-secondary" type="button" (click)="onSearch()">Cari</button>
        </div>
      </div>

      <div class="col-12 col-md-3 mb-3">
        <label class="form-label">Jenis Kelamin</label>
        <select class="form-control" [(ngModel)]="filterJenisKelamin" (change)="onFilterChange()">
          <option value="">-- Semua --</option>
          <option value="Laki-laki">Laki-laki</option>
          <option value="Perempuan">Perempuan</option>
        </select>
      </div>

      <div class="col-12 col-md-3 mb-3">
        <label class="form-label">Asuransi</label>
        <select class="form-control" [(ngModel)]="filterAsuransi" (change)="onFilterChange()">
          <option value="">-- Semua --</option>
          <option value="BPJS Kesehatan">BPJS Kesehatan</option>
          <option value="Asuransi Swasta">Asuransi Swasta</option>
          <option value="Mandiri Inhealth">Mandiri Inhealth</option>
          <option value="Tidak Ada">Tidak Ada</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="table-responsive">
          <div *ngIf="isLoading" class="alert alert-info">Memuat data...</div>

          <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

          <table
            *ngIf="!isLoading && dataPasien.length > 0"
            class="table table-striped table-hover"
          >
            <thead class="table-dark">
              <tr>
                <th>#</th>
                <th>Nama Pasien</th>
                <th>Tanggal Lahir</th>
                <th>Jenis Kelamin</th>
                <th>Asuransi</th>
                <th>Tanggal Daftar</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let pasien of dataPasien; let i = index">
                <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
                <td>{{ pasien.nama }}</td>
                <td>{{ pasien.tanggal_lahir | date : 'dd/MM/yyyy' }}</td>
                <td>{{ pasien.jenis_kelamin }}</td>
                <td>{{ pasien.asuransi }}</td>
                <td>{{ pasien.createdAt | date : 'dd/MM/yyyy HH:mm' }}</td>
                <td>
                  <button class="btn btn-sm btn-warning me-2">Edit</button>
                </td>
              </tr>
            </tbody>
          </table>

          <div *ngIf="!isLoading && dataPasien.length === 0" class="alert alert-warning">
            Tidak ada data pasien
          </div>
        </div>

        <div *ngIf="dataPasien.length > 0" class="row mt-4">
          <div class="col-12 d-flex justify-content-between align-items-center">
            <div>
              <small class="text-muted"
                >Menampilkan {{ (currentPage - 1) * pageSize + 1 }} -
                {{ Math.min(currentPage * pageSize, totalData) }} dari {{ totalData }} data</small
              >
            </div>
            <nav>
              <ul class="pagination mb-0">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <button class="page-link" (click)="onPageChange(1)">« Pertama</button>
                </li>
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <button class="page-link" (click)="onPageChange(currentPage - 1)">
                    ‹ Sebelum
                  </button>
                </li>
                <li class="page-item active">
                  <span class="page-link">{{ currentPage }}</span>
                </li>
                <li class="page-item" [class.disabled]="currentPage * pageSize >= totalData">
                  <button class="page-link" (click)="onPageChange(currentPage + 1)">
                    Sesudah ›
                  </button>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <app-create
        [(isDialogOpen)]="isDialogOpen"
        (submitted)="handleCreateSubmit($event)"
      ></app-create>
    </div>
  </div>
</div>
